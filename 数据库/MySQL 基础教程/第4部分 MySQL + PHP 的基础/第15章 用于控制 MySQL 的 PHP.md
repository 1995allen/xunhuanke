
> 本章之前，一直在 CUI 环境的 MySQL 监视器上执行 MySQL
> 本章开始，使用平常都能接触到 Web 浏览器来操作 MySQL

# 15.1 要创建的示例

# 15.2 在 Web 应用程序中使用 MySQL

- 将浏览器当做用户界面并在 Web 服务器端进行配置，通过网络来操作 MySQL 等的系统称为 Web 应用程序
- 创建 Web 程序需要用到编程语言， MySQL 支持 Perl、C、PHP 和 JAVA 等非常多的编程语言

# 15.3 使用 Web 时需要用到的机制

## 15.3.1 Web 服务器和客户端

- Web 服务器
  - Web 服务器是连接到互联网的机器
  - 设置了用于实现服务器功能的应用程序等内容
  - 服务器在被访问时会按照要求返回保存的数据
  - 或者执行指示的处理并返回结果
- 客户端
  - 会用 Web 服务器的用户的计算机被称为客户端
  - 当用户点击超链接时，客户端将向指定的 Web 服务器发送信息
  - Web 服务器收到请求后，会把指定的文本和图像等数据发送给客户端

## 15.3.2 Web 服务器的作用

- Web 服务器和客户端通过 HTTP（超文本传输协议） 进行通信
- 协议是计算机之间进行通信时需要共通遵循的规则

## 15.3.3 Apache 和 Web 服务器

- Web 服务器的功能由作为服务器连接到互联网的计算机上的软件负责处理
- Apache 是与 MySQL 以及后面介绍的 PHP 兼容性最好的 Web 服务器软件

[[专栏]] 有状态协议

- HTTP 是无协议状态
- 在 Web 上进行文本传输时使用的 FTP（文件传输协议）等需要维持连接状态的协议称为有状态协议

# 15.4 静态页面和动态页面

- 只具备点击超链接后相应的文件就能发送过来的功能，这种机制称为静态页面
- Web 页面是按照 HTML 格式编写的文件 [[第17章 PHP 脚本和 HTML#17 1 HTML 源代码]]
- 在动态页面中，服务器可以处理客户端发送的数据，并将相应的 Web 页面显示到客户端
- 通常会使用 Perl、Java 和 PHP 等编程语言来实现这种 “服务器端的处理” 功能

# 15.5 在 Web 上运行的程序

- 在 Web 上运行的程序的机制比较有名的有：
  - CGI (Common Gateway Interface, 公共网关接口)
  - 脚本

## 15.5.1 CGI

- CGI 是将程序放置在服务器上，通过响应来自 Web 浏览器的调用来执行程序的机制
- Perl 很早以前就用于创建访问计数器等应用

## 15.5.2 脚本

- 脚本最初指的是为了自动执行处理而创建的简单程序
  - 以各种各样的形式存在，比如单独创建成一个文本文件，或者编写在 HTML 文件中

- 客户端脚本
  - 指 JavaScript 等在客户端上运行的脚本
  - 与 Web 服务器完全无关，程序会在浏览网页上的个人计算机上执行
  - 如果 Web 服务器将脚本发送到客户端，之后不能做其他任何事情
- 服务器端脚本
  - 服务器端的脚本在 Web 服务器上执行
  - 当接受到来自客户端的命令后，Web 服务器上会完成处理，并将处理结果发送给客户端
  - 客户端只是用于查看处理结果而已
  - 数据库的处理通常会在服务器端进行，因此很适合使用服务器端脚本

# 15.6 什么是 PHP

## 15.6.1 PHP 是什么

- PHP
  - 是在 Web 服务器端运行的服务器端脚本
  - 因为执行的模块（最小单元程序）在 Web 服务器上且通过脚本的命令运行，所以一般来说运行速度很快
  - [PHP](http://pgp.net)
  - 全称 Hypertext Preprocessor 是一种用于 Web 应用程序的编程语言，支持 Apache 和微软公司开发的 IIS 等许多 Web 服务器
  - 是一门简单的语言，可以轻松创建脚本

## 15.6.2 本书使用的 PHP

- 在 Web 应用程序中处理 MySQL 所需的最低限度的基础知识

## 15.6.3 设置 php.ini

- 对 php.ini 配置文件设置用于处理日期、时间的时区，以及多字节字符串的相关内容
- 设置时区
  - MAMP\conf\php7.15
  - 时区默认为 UTC （世界标准时间）与北京时间差 8 小时
  - 703 行附近，删除开头的';'，date.timezone= 值设置为 Asia/Shanghai
  - ![设置时区](../image/2022-06-08-19-39-07.png)
- 设置多字节字符串
  - 处理中文时，如果不进行多字节字符串的相关设置，在函数的返回值包含中文的情况下就可能会发生乱码
  - 1232 行附近，删除开头的';'，mbstring.language = Japanese 修改为 mbstring.language = Chinese
- 设置完成后重启服务器

# 15.7 首先显示“欢迎光临”

## 15.7.1 确认 Apache 是否启动

- 略

[[专栏]] localhost 的 IP 地址

- localhost 的 IP 地址通常被指定为 127.0.0.1
- 亦即输入 `http://127.0.0.1/MAMP` 会显示相同的画面

## 15.7.2 首先用 PHP 显示“欢迎光临”

- 选择文本编辑器
  - windows 自带记事本，使用 UTF-8 时，会附加 BOM
    - 此时某些程序可能会发生意外错误，因此不建议使用记事本
  - Atom
    - 将 UTF-8 作为默认的字符编码，编写 PHP 程序时可以使用代码辅助等功能
    - [Atom](https://atom.io)
    - 已安装
    - 测试文件运行成功

## 15.7.3 没有正常显示时的解决对策

- 拼写错误
- 输入了全角空格
- 不是可以使用 PHP 的环境
- 保存在不同的文件夹中
  - Apache 发布的文件夹是固定的
  - 会根据环境的不同而发生变化
- 扩展名不是 “.php”
- 字符乱码
  - 确认 PHP 的程序文件是否使用了 UTF-8 保存

# 15.8 使用 PHP

## 15.8.1 编写 PHP 脚本时需要遵循的规则

- PHP 脚本文件的扩展名是 “.php”
- PHP 脚本以 “<?php” 开始，以 “?>” 结束
- 在行尾加上 “;”
- 字符串数据使用 "" 或 '' 括起来

```php
<?php
  执行的内容的描述 ;
?>
```

[[专栏]] 编写 PHP 脚本

- 可以通过修改 php.ini 设置使用 \<? 和 ?> 编写脚本

## 15.8.2 执行了什么处理

- 访问 test.php 文件
  - 浏览器第一步访问了此文件
- Web 服务器进行处理并返回结果
  - 实际运行的是 print "欢迎光临" ; 的部分
  - print 用于显示字符串的命令
- 插入 HTML 标签
  - `<br>` 是显示换行符的 HTML 标签

[[专栏]] print 和 echo

- 和 print 功能类似的命令有 echo
  - 使用方法相同
  - print 会返回 TRUE 这个值，默认为 1
  - echo 不返回值

```PHP
<?php
print print "你好";
?>
```

- 上述代码在浏览器中会显示 “你好1”
- 连续使用两个 echo 则会报错，因为 echo 不返回值

## 15.8.3 注释的写法

- 如果代码以 // 或 # 开头，则该行不会执行任何操作
- 代码在 /\* 和 */ 之间，则该部分不会执行任何操作

```PHP
<?php
// 这一行会被注释
# 这一行会被注释
/*
可以包括
多行
的
注释
*/
print "欢迎光临！";  /* 在行中间输入注释 */
/**** 显眼的注释 ****/
////// 同显眼的注释 //////
?>
```

## 15.8.4 phpinfo 函数

- 显示 PHP 环境信息
- ![phpinfo 函数](2022-06-08-20-07-33.png)
- 除 PHP 的版本和当前的设置内容之外，还包括 PDO [[第18章 使用 PHP 脚本操作 MySQL#18 1 2 什么是 PDO？什么是类？什么是方法？]] 驱动的相关信息

```PHP
<?php
phpinfo();
?>
```

[[专栏]] 使用 PHP 关闭操作系统

- exec 函数
  - 会执行参数中指定的命令
  - 可以代替通过命令提示符和终端输入命令使用
  - 可以创建一个内容为 `exec("SHUTDOWN -s")` 的 PHP 脚本，然后执行，1分钟后操作系统就会关闭
  - `exec("SHUTDOWN -s -t 10")` 10 秒后关机
- 本书在是 localhost 执行，关闭的是服务器

# 15.9 总结

- 介绍的内容
  - Apache、MySQL、PHP 的动作和它们在 Web 应用程序的执行中所起到的作用
  - 使用 PHP 的步骤
  - 编写 PHP 脚本的基础知识
  - 运行 PHP 脚本的方法
- 自我检查
  - 略
- 练习题

```php
<?php
print "<meta http-equiv='refresh' content='5;
URL= http://www.boc.cn/";
print "5秒后跳转到中国银行的页面"
?>
```
