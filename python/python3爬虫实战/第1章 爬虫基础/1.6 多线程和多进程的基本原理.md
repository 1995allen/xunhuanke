# 1.6 多线程和多进程的基本原理
> 在编写爬虫程序时，为了提高爬取效率，我们可能会同时运行多个爬虫任务，其中涉及==多进程==和==多线程==。

## 1.6.1 多线程的含义
> 说起多线程，就不得不先说什么事线程。说起线程，又不得不先说什么是进程。

【定义】 进程可以理解为一个独立运行的程序单位
- 例如：
  - 打开一个浏览器就是开启了一个浏览器进程，打开一个文本编辑器，就开启了一个文本编辑器进程。
  
- 进程是线程的集合，进程是由一个或多个线程构成的，线程是操作系统进行运算调度的最小单维，是进程中最小运行单元。
- 多线程就是一个进程中同时执行多个线程
## 1.6.2 并发和并行
- 并发
  - 处理器同一时刻只能执行一条指令，并发（concurrency）是指多个线程对应的多条指令被快速地执行。
  - 从宏观来看，并发是同时进行的（因为计算机处理指令速度极快，即使切换执行了指令，人感受不到）
  - 从微观来看，处理器连续不断地在多个线程之间切换和执行，每个线程的执行都会占用这个处理器的一个时间片段
- 并行
  - 并行（parallel）指同一时刻有多条指令在多个处理器上同时执行，这意味着并行必须依赖多个处理器。
  - 不论是从宏观还是微观来看，多个线程都是在同一时刻一起执行的。
---
- 并行只能存在于多处理器系统中，如果计算机处理器只有一个核，就不可能实现并行。而并发在单处理器和多处理器系统中都可以存在。
## 1.6.3 多线程适用场景
- 如果使用多线程，处理器就可以在某个线程处于等待态时，去执行其他线程，从而提高整体的执行效率
- 如果任务不全是计算密集型任务，就可以使用多线程来提高程序整体的执行效率。
- 尤其对于网络爬虫这种 IO 密集型任务，使用多线程能够大大提高程序整体的爬取效率。
## 1.6.4 多进程的含义
【定义】多进程，就是同时运行多个进程。
## 1.6.5 Python 中的多线程和多进程
- Python 中 GIL 的限制导致不论是在单核还是多核的条件下，同一时刻都只能运行一个线程，这使得 Python 无法发挥多核并行的优势。
- GIL 【定义】 全称为 Global Interpreter Lock，意思是==全局解释器锁==，其设计之处是处于对数据安全的考虑。
---
**在 Python 多线程下，每个线程的执行方式分三步**：
1. 获取 GIL
2. 执行对应线程的代码
3. 释放 GIL
- 某个线程想要执行，必须先拿到 GIL。
- 我们可以把 GIL 看着做通行证，并且在一个 Python 进程中，GIL 只有一个。
- 线程要是拿不到通行证，就不允许执行。
- 这样会导致即使在多和条件下，Python 进程中的多个线程在同一时刻也只能执行一个。
---
- 对于多进程来说，每个进程都有属于自己的 GIL，所以在多核处理器下，多进程的运行是不会受 GIL 影响的。（简单来说，就是多进程能更好的发挥多核优势）
- 对于爬虫这种 IO 密集型任务来说，多线程和多进程产生的影响差别并不大。
- 对于计算密集型任务来说，由于 GIL 的存在，Python 中多线程的整体运行效率在多核情况下可能比单核更低
- 而 Python 的多进程相比多线程，运行效率在多核情况下比单核会有成倍提升。
> 整体来看，Python 的多进程比多线程更有优势，如果条件允许，尽量用多进程。
---
### 多线程与多进程的扩展学习
1. Python：多线程的用法 [崔庆才博客：Python：多线程的用法](https://setup.scrape.center/python-threading)
2. Python：多进程的用法 [崔庆才博客：Python：多进程的用法](https://setup.scrape.center/python-multiprocessing)
## 1.6.6 总结
### 参考资料
1. 百度百科上多线程、多进程相关的内容
2. Python 官方文档中 threading 相关的内容 [Python_threading](https://docs.python.org/zh-cn/3/library/threading.html?highlight=threading#module-threading)
3. Python 官方文档中 multiprocessing 相关的内容 [Python_multiprocessing](https://docs.python.org/zh-cn/3/library/multiprocessing.html#module-multiprocessing)
4. 博客园网站上的“多进程和多线程的概念”文章[博客园_多进程和多线程的概念](https://www.cnblogs.com/linuxAndMcu/p/11064916.html)