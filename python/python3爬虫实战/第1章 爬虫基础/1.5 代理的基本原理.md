# 代理的基本原理
> 了解代理的基本原理，他是怎样实现伪装 IP 的呢？

## 1.5.1 基本原理
【定义】代理，实际上就是指代理服务器，英文叫做 Proxy Server，功能是代网络用户取得网络信息。

- 设置代理服务器，就是在客户端和服务器之间搭建一座桥，刺时客户端并非直接向 Web 服务器发起请求，而是把请求发送给代理服务器，然后由代理服务器把请求发送给 Web 服务器，Web 服务器返回的响应也是由代理服务器转发给客户端的。
- 这个过程中 Web 服务器识别出的真实 IP 就不再是客户端的 IP 了，成功实现了 IP 伪装，这就是代理的基本原理。
  
## 1.5.2 代理的作用
代理作用如下：
1. 突破自身 IP 的访问限制，访问一些平时不能访问的站点。
2. 访问一些单位或团体的内部资源
   1. 如，使用教育网内地址段的免费代理服务器，就可以下载和上传对教育网开放的各类 FTP，也可以查询、共享各类资料等。
3. 提高访问速度。
   1. 通常代理服务器会设置一个较大的硬盘缓冲区，当由外界的信息通过时，会同时将其保存到自己的缓冲区中，当其他用户访问相同的信息时，直接从缓冲区中取出信息，提高了访问速度。
4. 隐藏真实 IP。
   1. 上网者可以通过代理隐藏自己的 IP，免受攻击。
   2. 对于爬虫来说，使用代理就是为了隐藏自身 IP，防止自身的 IP 被封锁。

## 1.5.3 爬虫代理

- 使用代理隐藏真实的 IP，让服务器误以为是代理服务器在请求自己。
- 这样在爬取过程中不断更换代理，就可以避免 IP 被封锁，达到很好的爬取效果。
  
## 1.5.4 代理分类
### 根据协议区分
1. **FTP 代理服务器**：主要用于访问 FTP 服务器，一般有上传、下载以及缓存功能，端口一般为21、2121等
2. **HTTP 代理服务**：主要用于访问网页，一般有内容过滤和缓存功能，端口一般为80、8080、3128等
3. **SSL/TLS代理**：主要用于访问加密网站，一般有 SSL 或 TLS 加密功能（最高支持128位加密强度），端口一般为443。
4. **RTSP 代理**：主要用于 Realplayer 访问 Real 流媒体服务器，一般有缓存功能，端口一般为554.
5. **Telnet 代理**：主要用于 Telnet 远程控制（黑客入侵计算机时常用于隐藏身份），端口一般为23.
6. **POP3/SMTP 代理**：主要用于以 POP3/SMTP 方式收发邮件，一般有缓存功能，端口一般为 110/25.
7. **SOCKS 代理**：只是单纯传递数据包，不关心具体协议和用法，所以速度快很多，一般有缓存功能，端口一般为1080.
   1. SOCKS5 协议支持 TCP 和 UDP，包含 SOCKS4 的所有功能，且具备 SOCKS4 做不到的功能
### 根据匿名程度区分
1. **高度匿名代理**：高度匿名代理会将数据包原封不动地转发，在服务端看来似乎真的是一个普通客户端在访问，记录的 IP 则是代理服务器的 IP 
2. **普通匿名代理**：普通匿名代理会对数据包做一些改动，服务端可能会先正在访问自己的是个代理服务器，并且有一定概率去追查客户端的真实 IP。
   1. 这里代理服务器通常会加入的 HTTP 头有 HTTP_VIA 和 HTTP_X_FORWARDED_FOR
3. **透明代理**：透明代理不但改动了数据包，还会告诉服务器客户端的真实 IP。
   1. 这种代理除了能用缓存技术提高浏览速度，用内容过滤提高安全性之外，没有其他显著作用，最常见的例子是内网中的硬件防火墙。
4. **间谍代理**：间谍代理是由组织或个人创建的代理服务器，用于记录用户传输的数据，然后对记录的数据进行研究、监控等。

## 1.5.5 常见代理设置
1. 对于网上的免费代理，最好使用高度匿名代理，可以在使用前把所有代理都抓取下来筛选一下可用代理，也可以进一步维护一个代理池
2. 使用付费代理服务，互联网上存在许多可以付费使用的代理商，质量要比免费代理好很多。
3. ADSL 拨号，拨一次号换一次 IP，稳定性高，也是一种比较有效的封锁解决方案。
4. 蜂窝代理，即用 4G 或 5G 网卡等制作代理。
   1. 由于用蜂窝网络作为代理的情形比较少，因此在整体被封锁的概率会较低，但搭建蜂窝代理的成本是较高的。

## 1.5.6 总结
### 参考资料
1. 维基百科上代理服务器相关的内容[维基百科_代理服务器](https://zh.wikipedia.org/wiki/%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8)
2. 百度百科上代理相关的内容